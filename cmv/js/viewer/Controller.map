{"version":3,"file":"Controller.js","sources":["Controller.js"],"names":["define","Map","dom","domStyle","domGeom","domClass","on","array","BorderContainer","ContentPane","FloatingTitlePane","lang","mapOverlay","FloatingWidgetDialog","put","aspect","has","topic","PopupMobile","Menu","legendLayerInfos","editorLayerInfos","identifyLayerInfos","layerControlLayerInfos","panes","left","id","placeAt","collapsible","region","center","content","collapseButtons","startup","config","this","mapClickMode","current","defaultMapClickMode","defaultMode","add","screen","availWidth","availHeight","titles","addTitles","addTopics","initPanes","isDebug","window","app","subscribe","hitch","args","togglePane","pane","show","widgetLoader","options","position","mode","publish","header","headerTitleNode","byId","innerHTML","subHeader","subHeaderTitle","pageTitle","document","title","key","hasOwnProperty","mixin","outer","design","gutters","body","type","clone","initMap","collapseButtonsPane","domNode","parentNode","positionSideBarToggle","splitter","_splitterWidget","after","undefined","open","map","root","top","bottom","matchMedia","addListener","resize","mapOptions","infoWindow","basemap","initLayers","operationalLayers","length","once","initWidgets","evt","pnt","target","extent","getCenter","setTimeout","centerAt","layers","layerTypes","csv","dynamic","feature","georss","image","kml","label","mapimage","osm","tiled","wms","wmts","modules","forEach","layer","push","handleError","source","error","require","addLayers","initLayer","Layer","l","url","unshift","controlOptions","featureLayer","idOptions","exclude","paneWidgets","widgets","widget","include","filter","sort","a","b","i","disp","get","set","btn","rCls","aCls","remove","children","pos","orie","getMarginBox","toString","repositionSideBarButtons","btns","splitterStartDrag","splitterStopDrag","_createTitlePaneWidget","parentId","canFloat","tp","sidebar","_createFloatingWidget","fw","_createContentPaneWidget","className","cp","widgetConfig","pnl","widgetTypes","indexOf","parentWidget","path","createWidget","WidgetClass","mapRightClickMenu","targetNodeIds","selector","layerInfos","containerNode","srcNodeRef","_started","option"],"mappings":";;;;;AAAAA,QACC,WACA,WACA,iBACA,oBACA,iBACA,UACA,mBACA,+BACA,2BACA,8BACA,kBACA,wCACA,iCACA,eACA,cACA,WACA,aACA,yBACA,aACA,wBACE,SAAUC,EAAKC,EAAKC,EAAUC,EAASC,EAAUC,EAAIC,EAAOC,EAAiBC,EAAaC,EAAmBC,EAAMC,EAAYC,EAAsBC,EAAKC,EAAQC,EAAKC,EAAOC,EAAaC,GAE7L,OACCC,oBACAC,oBACAC,sBACAC,0BACAC,OACCC,MACCC,GAAI,cACJC,QAAS,QACTC,aAAa,EACbC,OAAQ,QAETC,QACCJ,GAAI,YACJC,QAAS,QACTE,OAAQ,SACRE,QAASnB,IAGXoB,mBACAC,QAAS,SAAUC,GAClBC,KAAKD,OAASA,EACdC,KAAKC,cACJC,QAASH,EAAOI,oBAChBC,YAAaL,EAAOI,qBAGjBtB,EAAI,WAAaA,EAAI,QAAUA,EAAI,YAAcA,EAAI,SACxDA,EAAIwB,IAAI,UAAU,GACdC,OAAOC,WAAa,KAAOD,OAAOE,YAAc,IACnD3B,EAAIwB,IAAI,SAAS,GAEjBxB,EAAIwB,IAAI,UAAU,IAGhBN,EAAOU,QACVT,KAAKU,YAENV,KAAKW,YACLX,KAAKY,YAEDb,EAAOc,UACVC,OAAOC,IAAMf,OAIfW,UAAW,WAEV7B,EAAMkC,UAAU,oBAAqBxC,EAAKyC,MAAMjB,KAAM,SAAUkB,GAC/DlB,KAAKmB,WAAWD,EAAKE,KAAMF,EAAKG,SAIjCvC,EAAMkC,UAAU,oBAAqBxC,EAAKyC,MAAMjB,KAAM,SAAUkB,GAC/DlB,KAAKsB,aAAaJ,EAAKK,QAASL,EAAKM,aAIlCxB,KAAKD,OAAOc,SACf/B,EAAMkC,UAAU,qBAAsBxC,EAAKyC,MAAMjB,KAAM,gBAIxDlB,EAAMkC,UAAU,0BAA2BxC,EAAKyC,MAAMjB,KAAM,SAAUyB,GACrEzB,KAAKC,aAAaC,QAAUuB,EAC5B3C,EAAM4C,QAAQ,0BAA2BD,MAI1C3C,EAAMkC,UAAU,0BAA2BxC,EAAKyC,MAAMjB,KAAM,WAC3DlB,EAAM4C,QAAQ,0BAA2B1B,KAAKC,aAAaG,iBAK7DM,UAAW,WACV,GAAID,GAAST,KAAKD,OAAOU,MACzB,IAAIA,EAAOkB,OAAQ,CAClB,GAAIC,GAAkB7D,EAAI8D,KAAK,kBAC3BD,KACHA,EAAgBE,UAAYrB,EAAOkB,QAGrC,GAAIlB,EAAOsB,UAAW,CACrB,GAAIC,GAAiBjE,EAAI8D,KAAK,qBAC1BG,KACHA,EAAeF,UAAYrB,EAAOsB,WAGhCtB,EAAOwB,YACVC,SAASC,MAAQ1B,EAAOwB,YAI1BrB,UAAW,WACV,GAAIwB,GAAK/C,EAAQW,KAAKD,OAAOV,SAC7B,KAAK+C,IAAOpC,MAAKX,MACZW,KAAKX,MAAMgD,eAAeD,KAC7B/C,EAAM+C,GAAO5D,EAAK8D,MAAMtC,KAAKX,MAAM+C,GAAM/C,EAAM+C,IAIjDpC,MAAKX,MAAMkD,MAAQ,GAAIlE,IACtBkB,GAAI,uBACJiD,OAAQ,UACRC,SAAS,IACPjD,QAAQ0C,SAASQ,KAEpB,IAAInB,GAAS/B,EAASmD,CACtB,KAAKP,IAAO/C,GACPA,EAAMgD,eAAeD,KACxBb,EAAU/C,EAAKoE,MAAMvD,EAAM+C,IAC3B5C,EAAUQ,KAAKX,MAAMkC,EAAQ/B,UAAYQ,KAAKX,MAAMkD,MACpDhB,EAAQhC,GAAKgC,EAAQhC,IAAM6C,EAC3BO,EAAOpB,EAAQoB,WACRpB,GAAQ/B,cACR+B,GAAQoB,WACRpB,GAAQ9B,YACXD,IACU,WAATmD,EACH3C,KAAKX,MAAM+C,GAAO,GAAI/D,GAAgBkD,GAAS/B,QAAQA,GAC7C+B,EAAQ7B,SAClBM,KAAKX,MAAM+C,GAAO,GAAI9D,GAAYiD,GAAS/B,QAAQA,KAKvDQ,MAAKX,MAAMkD,MAAMzC,UACjBE,KAAK6C,UAIL7C,KAAK8C,oBAAsB9C,KAAKD,OAAO+C,qBAAuB,OAE9D,KAAKV,IAAO/C,GACX,GAAIA,EAAMgD,eAAeD,GAAM,CAC9B,GAAI/C,EAAM+C,GAAK3C,YAAa,CAI3B,GAHAO,KAAKH,gBAAgBuC,GAAOzD,EAAIqB,KAAKX,MAAMW,KAAK8C,qBAAqBC,QAAS,oCAAsCX,EAAM,wCAAmD,WAARA,GAA4B,QAARA,EAAiB,OAAS,QAAU,+BAA+BY,WAC5P7E,EAAG6B,KAAKH,gBAAgBuC,GAAM,QAAS5D,EAAKyC,MAAMjB,KAAM,aAAcoC,IACtEpC,KAAKiD,sBAAsBb,GACM,UAA7BpC,KAAK8C,oBAAiC,CACzC,GAAII,GAAWlD,KAAKX,MAAM+C,GAAKe,eAC3BD,KACHtE,EAAOwE,MAAMF,EAAU,aAAc1E,EAAKyC,MAAMjB,KAAM,oBAAqBoC,IAC3ExD,EAAOwE,MAAMF,EAAU,YAAa1E,EAAKyC,MAAMjB,KAAM,mBAAoBoC,KAGnDiB,SAApBhE,EAAM+C,GAAKkB,MACdtD,KAAKmB,WAAWiB,EAAK/C,EAAM+C,GAAKkB,MAGtB,WAARlB,GAAoBpC,KAAKX,MAAM+C,GAAKe,kBACvCjF,EAASmC,IAAIL,KAAKuD,IAAIC,KAAKR,WAAY,OAASZ,GACpC,UAARA,GAAmBpC,KAAKX,MAAMoE,KACjCvF,EAASmC,IAAIL,KAAKX,MAAMoE,IAAIV,QAAS,OAASX,GAEnC,UAARA,GAAmBpC,KAAKX,MAAMqE,QACjCxF,EAASmC,IAAIL,KAAKX,MAAMqE,OAAOX,QAAS,OAASX,GAEtC,SAARA,GAAkBpC,KAAKX,MAAMoE,KAChCvF,EAASmC,IAAIL,KAAKX,MAAMoE,IAAIV,QAAS,OAASX,GAEnC,SAARA,GAAkBpC,KAAKX,MAAMqE,QAChCxF,EAASmC,IAAIL,KAAKX,MAAMqE,OAAOX,QAAS,OAASX,IAQjDtB,OAAO6C,aACV7C,OAAO6C,WAAW,sBAAsBC,YAAYpF,EAAKyC,MAAMjB,KAAM,6BACrEc,OAAO6C,WAAW,sBAAsBC,YAAYpF,EAAKyC,MAAMjB,KAAM,8BAGtEA,KAAKX,MAAMkD,MAAMsB,UAElBhB,QAAS,WACJhE,EAAI,WAAamB,KAAKD,OAAO+D,WAAWC,aAC3C/D,KAAKD,OAAO+D,WAAWC,WAAa,GAAIhF,GAAY,KAAMJ,EAAI,SAE/DqB,KAAKuD,IAAM,GAAIzF,GAAI,YAAakC,KAAKD,OAAO+D,YACxC9D,KAAKD,OAAO+D,WAAWE,QAC1BhE,KAAKuD,IAAIpF,GAAG,OAAQK,EAAKyC,MAAMjB,KAAM,eAErCA,KAAKiE,aAEFjE,KAAKD,OAAOmE,mBAAqBlE,KAAKD,OAAOmE,kBAAkBC,OAAS,EAC3EhG,EAAGiG,KAAKpE,KAAKuD,IAAK,oBAAqB/E,EAAKyC,MAAMjB,KAAM,gBAExDA,KAAKqE,eAGPJ,WAAY,WACXjE,KAAKuD,IAAIpF,GAAG,SAAU,SAAUmG,GAC/B,GAAIC,GAAMD,EAAIE,OAAOC,OAAOC,WAC5BC,YAAW,WACVL,EAAIE,OAAOI,SAASL,IAClB,OAGJvE,KAAK6E,SACL,IAAIC,IACHC,IAAK,MACLC,QAAS,0BACTC,QAAS,UACTC,OAAQ,SACRC,MAAO,qBACPC,IAAK,MACLC,MAAO,QACPC,SAAU,WACVC,IAAK,gBACLC,MAAO,wBACPC,IAAK,MACLC,KAAM,QAGHC,IACJvH,GAAMwH,QAAQ5F,KAAKD,OAAOmE,kBAAmB,SAAU2B,GACtD,GAAIlD,GAAOmC,EAAWe,EAAMlD,KACxBA,GACHgD,EAAQG,KAAK,eAAiBnD,EAAO,SAErC3C,KAAK+F,aACJC,OAAQ,aACRC,MAAO,eAAiBJ,EAAMlD,KAAO,0BAGrC3C,MACHkG,QAAQP,EAASnH,EAAKyC,MAAMjB,KAAM,WACjC5B,EAAMwH,QAAQ5F,KAAKD,OAAOmE,kBAAmB,SAAU2B,GACtD,GAAIlD,GAAOmC,EAAWe,EAAMlD,KACxBA,IACHuD,SAAS,eAAiBvD,EAAO,SAAUnE,EAAKyC,MAAMjB,KAAM,YAAa6F,KAExE7F,MACHA,KAAKuD,IAAI4C,UAAUnG,KAAK6E,YAG1BuB,UAAW,SAAUP,EAAOQ,GAC3B,GAAIC,GAAI,GAAID,GAAMR,EAAMU,IAAKV,EAAMtE,QAcnC,IAbAvB,KAAK6E,OAAO2B,QAAQF,GAEpBtG,KAAKf,iBAAiBuH,SACrBX,MAAOS,EACPnE,MAAO0D,EAAM1D,OAAS,OAGvBnC,KAAKZ,uBAAuBoH,SAC3BX,MAAOS,EACP3D,KAAMkD,EAAMlD,KACZR,MAAO0D,EAAM1D,MACbsE,eAAgBZ,EAAMzG,yBAEJ,YAAfyG,EAAMlD,KAAoB,CAC7B,GAAIpB,IACHmF,aAAcJ,EAEXT,GAAM3G,kBACTV,EAAK8D,MAAMf,EAASsE,EAAM3G,kBAE3Bc,KAAKd,iBAAiB4G,KAAKvE,GAE5B,GAAmB,YAAfsE,EAAMlD,MAAqC,YAAfkD,EAAMlD,KAAoB,CACzD,GAAIgE,IACHd,MAAOS,EACPnE,MAAO0D,EAAM1D,MAEV0D,GAAM1G,oBACTX,EAAK8D,MAAMqE,EAAWd,EAAM1G,oBAEzBwH,EAAUC,WAAY,GACzB5G,KAAKb,mBAAmB2G,KAAKa,KAIhCtC,YAAa,WACZ,GACCwC,GADGC,IAGJ,KAAK,GAAI1E,KAAOpC,MAAKD,OAAO+G,QAC3B,GAAI9G,KAAKD,OAAO+G,QAAQzE,eAAeD,GAAM,CAC5C,GAAI2E,GAASvI,EAAKoE,MAAM5C,KAAKD,OAAO+G,QAAQ1E,GACxC2E,GAAOC,UACVD,EAAOvF,SAAY,mBAAwBuF,GAAe,SAAKA,EAAOvF,SAAW,IACjFsF,EAAQhB,KAAKiB,IAIhB,IAAK,GAAI3F,KAAQpB,MAAKX,OACjBW,KAAKX,MAAMgD,eAAejB,IAAmB,UAATA,GAA6B,WAATA,IAC3DyF,EAAczI,EAAM6I,OAAOH,EAAS,SAAUC,GAC7C,MAAQA,GAAOvH,SAAWuH,EAAOvH,UAAY4B,IAE9CyF,EAAYK,KAAK,SAAUC,EAAGC,GAC7B,MAAOD,GAAE3F,SAAW4F,EAAE5F,WAEvBpD,EAAMwH,QAAQiB,EAAa,SAAUE,EAAQM,GAC5CrH,KAAKsB,aAAayF,EAAQM,IACxBrH,MAGL6G,GAAczI,EAAM6I,OAAOH,EAAS,SAAUC,GAC7C,OAAQA,EAAOvH,UAEhBqH,EAAYK,KAAK,SAAUC,EAAGC,GAC7B,MAAOD,GAAE3F,SAAW4F,EAAE5F,WAGvBpD,EAAMwH,QAAQiB,EAAa,SAAUE,EAAQM,GAC5CrH,KAAKsB,aAAayF,EAAQM,IACxBrH,OAEJmB,WAAY,SAAU5B,EAAI8B,GACzB,GAAKrB,KAAKX,MAAME,GAAhB,CAGA,GAAIwD,GAAU/C,KAAKX,MAAME,GAAIwD,OAC7B,IAAIA,EAAS,CACZ,GAAIuE,GAAQjG,GAA0B,gBAAX,GAAuBA,EAA6C,SAArCrD,EAASuJ,IAAIxE,EAAS,WAAyB,QAAU,MACnH/E,GAASwJ,IAAIzE,EAAS,UAAWuE,GAC7BtH,KAAKX,MAAME,GAAI4D,iBAClBnF,EAASwJ,IAAIxH,KAAKX,MAAME,GAAI4D,gBAAgBJ,QAAS,UAAWuE,GAEjEtH,KAAKiD,sBAAsB1D,GACvBS,KAAKX,MAAMkD,OACdvC,KAAKX,MAAMkD,MAAMsB,YAIpBZ,sBAAuB,SAAU1D,GAChC,GAAI6B,GAAOpB,KAAKX,MAAME,GAClBkI,EAAMzH,KAAKH,gBAAgBN,EAC/B,IAAK6B,GAASqG,EAAd,CAGA,GAAIH,GAAOtJ,EAASuJ,IAAInG,EAAK2B,QAAS,WAClC2E,EAAiB,SAATJ,EAAmB,QAAU,OACrCK,EAAiB,SAATL,EAAmB,OAAS,OAMxC,IALApJ,EAAS0J,OAAOH,EAAII,SAAS,GAAIH,GACjCxJ,EAASmC,IAAIoH,EAAII,SAAS,GAAIF,GAIG,UAA7B3H,KAAK8C,oBAAiC,CACzC,GAAIgF,GAAO1G,EAAoB,gBAAI,EAAI,GACnC2G,EAAe,WAAPxI,GAA0B,QAAPA,EAAgB,IAAM,GACxC,WAAT+H,IACHQ,GAAO7J,EAAQ+J,aAAa5G,EAAK2B,SAASgF,IAEvC3G,EAAK+B,kBACR2E,GAAO7J,EAAQ+J,aAAa5G,EAAK+B,gBAAgBJ,SAASgF,IAE3D/J,EAASwJ,IAAIC,EAAKlI,EAAIuI,EAAIG,WAAa,MACvCjK,EAASwJ,IAAIC,EAAK,UAAW,YAI/BS,yBAA0B,WACzB,GAAIC,IAAQ,OAAQ,QAAS,MAAO,SACpC/J,GAAMwH,QAAQuC,EAAM3J,EAAKyC,MAAMjB,KAAM,SAAUT,GAC9CS,KAAKiD,sBAAsB1D,OAM7B6I,kBAAmB,SAAU7I,GAC5B,GAAIkI,GAAMzH,KAAKH,gBAAgBN,EAC/BvB,GAASwJ,IAAIC,EAAK,UAAW,SAE9BY,iBAAkB,SAAU9I,GAC3BS,KAAKiD,sBAAsB1D,IAG5B+I,uBAAwB,SAAUC,EAAUpG,EAAOX,EAAU8B,EAAMkF,EAAUhJ,GAC5E,GAAIiJ,GAAIlH,GACNY,MAAOA,GAAS,SAChBmB,KAAMA,IAAQ,EACdkF,SAAUA,IAAY,EAgBxB,OAdID,KACHhH,EAAQhC,GAAKgJ,GAEW,gBAAd,KACV/I,EAAUQ,KAAKX,MAAMG,IAEjBA,IACJA,EAAUQ,KAAKX,MAAMC,MAElBE,IACH+B,EAAQmH,QAAUlJ,EAClBiJ,EAAK,GAAIlK,GAAkBgD,GAAS/B,QAAQA,EAASgC,GACrDiH,EAAG3I,WAEG2I,GAERE,sBAAuB,SAAUJ,EAAUpG,GAC1C,GAAIZ,IACHY,MAAOA,EAEJoG,KACHhH,EAAQhC,GAAKgJ,EAEd,IAAIK,GAAK,GAAIlK,GAAqB6C,EAElC,OADAqH,GAAG9I,UACI8I,GAERC,yBAA0B,SAAUN,EAAUpG,EAAO2G,EAAWpJ,EAAQF,GACvE,GAAIuJ,GAAIxH,GACNY,MAAOA,EACPzC,OAAQA,GAAU,SAiBpB,OAfIoJ,KACHvH,EAAQuH,UAAYA,GAEjBP,IACHhH,EAAQhC,GAAKgJ,GAET/I,EAE2B,gBAAd,KACjBA,EAAUQ,KAAKX,MAAMG,IAFrBA,EAAUQ,KAAKX,MAAMqJ,QAIlBlJ,IACHuJ,EAAK,GAAIzK,GAAYiD,GAAS/B,QAAQA,GACtCuJ,EAAGjJ,WAEGiJ,GAERzH,aAAc,SAAU0H,EAAcxH,GACrC,GAAI+G,GAAUU,EAGVC,GAAe,YAAa,cAAe,WAAY,UAAW,YAAa,MACnF,OAAI9K,GAAM+K,QAAQD,EAAaF,EAAarG,MAAQ,MACnD3C,MAAK+F,aACJC,OAAQ,aACRC,MAAO,gBAAkB+C,EAAarG,KAAO,MAAQqG,EAAa7G,MAAQ,iBAAmBX,EAAW,yBAM/E,cAAtBwH,EAAarG,MAA8C,gBAAtBqG,EAAarG,MAAgD,aAAtBqG,EAAarG,OAAyBqG,EAAazJ,IAAMyJ,EAAazJ,GAAG4E,OAAS,IAClKoE,EAAWS,EAAazJ,GAAK,UACH,cAAtByJ,EAAarG,KAChBsG,EAAMjJ,KAAKsI,uBAAuBC,EAAUS,EAAa7G,MAAOX,EAAUwH,EAAa1F,KAAM0F,EAAaR,SAAUQ,EAAaxJ,SACjG,gBAAtBwJ,EAAarG,KACvBsG,EAAMjJ,KAAK6I,yBAAyBN,EAAUS,EAAa7G,MAAO6G,EAAaF,UAAWE,EAAatJ,OAAQsJ,EAAaxJ,SAC5F,aAAtBwJ,EAAarG,OACvBsG,EAAMjJ,KAAK2I,sBAAsBJ,EAAUS,EAAa7G,QAEzD6G,EAAaI,aAAeH,QAIS,gBAA1BD,GAAoB,QAC/B9C,SAAS8C,EAAazH,QAASyH,EAAaK,MAAO7K,EAAKyC,MAAMjB,KAAM,eAAgBgJ,IAEpF9C,SAAS8C,EAAaK,MAAO7K,EAAKyC,MAAMjB,KAAM,eAAgBgJ,EAAcA,EAAazH,aAG3F+H,aAAc,SAAUN,EAAczH,EAASgI,GAE9ChI,EAAQhC,GAAKyJ,EAAazJ,GAAK,UAC/BgC,EAAQ6H,aAAeJ,EAAaI,aAGhC7H,EAAQgC,MACXhC,EAAQgC,IAAMvD,KAAKuD,KAEhBhC,EAAQiI,oBAENxJ,KAAKwJ,oBACTxJ,KAAKwJ,kBAAoB,GAAIxK,IAC5ByK,eAAgBzJ,KAAKuD,IAAIC,MACzBkG,SAAU,eAEX1J,KAAKwJ,kBAAkB1J,WAExByB,EAAQiI,kBAAoBxJ,KAAKwJ,mBAE9BjI,EAAQtB,eACXsB,EAAQtB,aAAeD,KAAKC,aAAaC,SAEtCqB,EAAQtC,mBACXsC,EAAQoI,WAAa3J,KAAKf,kBAEvBsC,EAAQnC,yBACXmC,EAAQoI,WAAa3J,KAAKZ,wBAEvBmC,EAAQrC,mBACXqC,EAAQoI,WAAa3J,KAAKd,kBAEvBqC,EAAQpC,qBACXoC,EAAQoI,WAAa3J,KAAKb,mBAI3B,IAAI8J,GAAM1H,EAAQ6H,YAEjBpJ,MAAKgJ,EAAazJ,IADQ,cAAtByJ,EAAarG,MAA8C,gBAAtBqG,EAAarG,MAAgD,aAAtBqG,EAAarG,KACrE,GAAI4G,GAAYhI,EAAS5C,EAAI,QAAQa,QAAQyJ,EAAIW,eACzC,YAAtBZ,EAAarG,KACC,GAAI4G,GAAYhI,EAASyH,EAAaa,YAEtC,GAAIN,GAAYhI,GAIrCvB,KAAKgJ,EAAazJ,KAAOS,KAAKgJ,EAAazJ,IAAIO,UAAYE,KAAKgJ,EAAazJ,IAAIuK,UACpF9J,KAAKgJ,EAAazJ,IAAIO,WAIxBiG,YAAa,SAAUxE,GACtB,GAAIvB,KAAKD,OAAOc,SACU,gBAAd,SACV,IAAK,GAAIkJ,KAAUxI,GACdA,EAAQc,eAAe0H","sourcesContent":["define([\n\t'esri/map',\n\t'dojo/dom',\n\t'dojo/dom-style',\n\t'dojo/dom-geometry',\n\t'dojo/dom-class',\n\t'dojo/on',\n\t'dojo/_base/array',\n\t'dijit/layout/BorderContainer',\n\t'dijit/layout/ContentPane',\n\t'gis/dijit/FloatingTitlePane',\n\t'dojo/_base/lang',\n\t'dojo/text!./templates/mapOverlay.html',\n\t'gis/dijit/FloatingWidgetDialog',\n\t'put-selector',\n\t'dojo/aspect',\n\t'dojo/has',\n\t'dojo/topic',\n\t'esri/dijit/PopupMobile',\n\t'dijit/Menu',\n\t'esri/IdentityManager'\n], function (Map, dom, domStyle, domGeom, domClass, on, array, BorderContainer, ContentPane, FloatingTitlePane, lang, mapOverlay, FloatingWidgetDialog, put, aspect, has, topic, PopupMobile, Menu) {\n\n\treturn {\n\t\tlegendLayerInfos: [],\n\t\teditorLayerInfos: [],\n\t\tidentifyLayerInfos: [],\n\t\tlayerControlLayerInfos: [],\n\t\tpanes: {\n\t\t\tleft: {\n\t\t\t\tid: 'sidebarLeft',\n\t\t\t\tplaceAt: 'outer',\n\t\t\t\tcollapsible: true,\n\t\t\t\tregion: 'left'\n\t\t\t},\n\t\t\tcenter: {\n\t\t\t\tid: 'mapCenter',\n\t\t\t\tplaceAt: 'outer',\n\t\t\t\tregion: 'center',\n\t\t\t\tcontent: mapOverlay\n\t\t\t}\n\t\t},\n\t\tcollapseButtons: {},\n\t\tstartup: function (config) {\n\t\t\tthis.config = config;\n\t\t\tthis.mapClickMode = {\n\t\t\t\tcurrent: config.defaultMapClickMode,\n\t\t\t\tdefaultMode: config.defaultMapClickMode\n\t\t\t};\n\t\t\t// simple feature detection. kinda like dojox/mobile without the overhead\n\t\t\tif (has('touch') && (has('ios') || has('android') || has('bb'))) {\n\t\t\t\thas.add('mobile', true);\n\t\t\t\tif (screen.availWidth < 500 || screen.availHeight < 500) {\n\t\t\t\t\thas.add('phone', true);\n\t\t\t\t} else {\n\t\t\t\t\thas.add('tablet', true);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (config.titles) {\n\t\t\t\tthis.addTitles();\n\t\t\t}\n\t\t\tthis.addTopics();\n\t\t\tthis.initPanes();\n\n\t\t\tif (config.isDebug) {\n\t\t\t\twindow.app = this; //dev only\n\t\t\t}\n\t\t},\n\t\t// add topics for subscribing and publishing\n\t\taddTopics: function () {\n\t\t\t// toggle a sidebar pane\n\t\t\ttopic.subscribe('viewer/togglePane', lang.hitch(this, function (args) {\n\t\t\t\tthis.togglePane(args.pane, args.show);\n\t\t\t}));\n\n\t\t\t// load a widget\n\t\t\ttopic.subscribe('viewer/loadWidget', lang.hitch(this, function (args) {\n\t\t\t\tthis.widgetLoader(args.options, args.position);\n\t\t\t}));\n\n\t\t\t// setup error handler. centralize the debugging\n\t\t\tif (this.config.isDebug) {\n\t\t\t\ttopic.subscribe('viewer/handleError', lang.hitch(this, 'handleError'));\n\t\t\t}\n\n\t\t\t// set the current mapClickMode\n\t\t\ttopic.subscribe('mapClickMode/setCurrent', lang.hitch(this, function (mode) {\n\t\t\t\tthis.mapClickMode.current = mode;\n\t\t\t\ttopic.publish('mapClickMode/currentSet', mode);\n\t\t\t}));\n\n\t\t\t// set the current mapClickMode to the default mode\n\t\t\ttopic.subscribe('mapClickMode/setDefault', lang.hitch(this, function () {\n\t\t\t\ttopic.publish('mapClickMode/setCurrent', this.mapClickMode.defaultMode);\n\t\t\t}));\n\n\t\t},\n\t\t// set titles (if any)\n\t\taddTitles: function () {\n\t\t\tvar titles = this.config.titles;\n\t\t\tif (titles.header) {\n\t\t\t\tvar headerTitleNode = dom.byId('headerTitleSpan');\n\t\t\t\tif (headerTitleNode) {\n\t\t\t\t\theaderTitleNode.innerHTML = titles.header;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (titles.subHeader) {\n\t\t\t\tvar subHeaderTitle = dom.byId('subHeaderTitleSpan');\n\t\t\t\tif (subHeaderTitle) {\n\t\t\t\t\tsubHeaderTitle.innerHTML = titles.subHeader;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (titles.pageTitle) {\n\t\t\t\tdocument.title = titles.pageTitle;\n\t\t\t}\n\t\t},\n\t\t// setup all the sidebar panes\n\t\tinitPanes: function () {\n\t\t\tvar key, panes = this.config.panes || {};\n\t\t\tfor (key in this.panes) {\n\t\t\t\tif (this.panes.hasOwnProperty(key)) {\n\t\t\t\t\tpanes[key] = lang.mixin(this.panes[key], panes[key]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.panes.outer = new BorderContainer({\n\t\t\t\tid: 'borderContainerOuter',\n\t\t\t\tdesign: 'sidebar',\n\t\t\t\tgutters: false\n\t\t\t}).placeAt(document.body);\n\n\t\t\tvar options, placeAt, type;\n\t\t\tfor (key in panes) {\n\t\t\t\tif (panes.hasOwnProperty(key)) {\n\t\t\t\t\toptions = lang.clone(panes[key]);\n\t\t\t\t\tplaceAt = this.panes[options.placeAt] || this.panes.outer;\n\t\t\t\t\toptions.id = options.id || key;\n\t\t\t\t\ttype = options.type;\n\t\t\t\t\tdelete options.placeAt;\n\t\t\t\t\tdelete options.type;\n\t\t\t\t\tdelete options.collapsible;\n\t\t\t\t\tif (placeAt) {\n\t\t\t\t\t\tif (type === 'border') {\n\t\t\t\t\t\t\tthis.panes[key] = new BorderContainer(options).placeAt(placeAt);\n\t\t\t\t\t\t} else if (options.region) {\n\t\t\t\t\t\t\tthis.panes[key] = new ContentPane(options).placeAt(placeAt);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.panes.outer.startup();\n\t\t\tthis.initMap();\n\n\t\t\t// where to place the buttons\n\t\t\t// either the center map pane or the outer pane?\n\t\t\tthis.collapseButtonsPane = this.config.collapseButtonsPane || 'outer';\n\n\t\t\tfor (key in panes) {\n\t\t\t\tif (panes.hasOwnProperty(key)) {\n\t\t\t\t\tif (panes[key].collapsible) {\n\t\t\t\t\t\tthis.collapseButtons[key] = put(this.panes[this.collapseButtonsPane].domNode, 'div.sidebarCollapseButton.sidebar' + key + 'CollapseButton.sidebarCollapseButton' + ((key === 'bottom' || key === 'top') ? 'Vert' : 'Horz') + ' div.dijitIcon.button.close').parentNode;\n\t\t\t\t\t\ton(this.collapseButtons[key], 'click', lang.hitch(this, 'togglePane', key));\n\t\t\t\t\t\tthis.positionSideBarToggle(key);\n\t\t\t\t\t\tif (this.collapseButtonsPane === 'outer') {\n\t\t\t\t\t\t\tvar splitter = this.panes[key]._splitterWidget;\n\t\t\t\t\t\t\tif (splitter) {\n\t\t\t\t\t\t\t\taspect.after(splitter, '_startDrag', lang.hitch(this, 'splitterStartDrag', key));\n\t\t\t\t\t\t\t\taspect.after(splitter, '_stopDrag', lang.hitch(this, 'splitterStopDrag', key));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (panes[key].open !== undefined) {\n\t\t\t\t\t\t\tthis.togglePane(key, panes[key].open);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (key !== 'center' && this.panes[key]._splitterWidget) {\n\t\t\t\t\t\tdomClass.add(this.map.root.parentNode, 'pane' + key);\n\t\t\t\t\t\tif (key === 'right' && this.panes.top) {\n\t\t\t\t\t\t\tdomClass.add(this.panes.top.domNode, 'pane' + key);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (key === 'right' && this.panes.bottom) {\n\t\t\t\t\t\t\tdomClass.add(this.panes.bottom.domNode, 'pane' + key);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (key === 'left' && this.panes.top) {\n\t\t\t\t\t\t\tdomClass.add(this.panes.top.domNode, 'pane' + key);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (key === 'left' && this.panes.bottom) {\n\t\t\t\t\t\t\tdomClass.add(this.panes.bottom.domNode, 'pane' + key);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// respond to media query changes\n\t\t\t// matchMedia works in most browsers (http://caniuse.com/#feat=matchmedia)\n\t\t\tif (window.matchMedia) {\n\t\t\t\twindow.matchMedia('(max-width: 991px)').addListener(lang.hitch(this, 'repositionSideBarButtons'));\n\t\t\t\twindow.matchMedia('(max-width: 767px)').addListener(lang.hitch(this, 'repositionSideBarButtons'));\n\t\t\t}\n\n\t\t\tthis.panes.outer.resize();\n\t\t},\n\t\tinitMap: function () {\n\t\t\tif (has('phone') && !this.config.mapOptions.infoWindow) {\n\t\t\t\tthis.config.mapOptions.infoWindow = new PopupMobile(null, put('div'));\n\t\t\t}\n\t\t\tthis.map = new Map('mapCenter', this.config.mapOptions);\n\t\t\tif (this.config.mapOptions.basemap) {\n\t\t\t\tthis.map.on('load', lang.hitch(this, 'initLayers'));\n\t\t\t} else {\n\t\t\t\tthis.initLayers();\n\t\t\t}\n\t\t\tif (this.config.operationalLayers && this.config.operationalLayers.length > 0) {\n\t\t\t\ton.once(this.map, 'layers-add-result', lang.hitch(this, 'initWidgets'));\n\t\t\t} else {\n\t\t\t\tthis.initWidgets();\n\t\t\t}\n\t\t},\n\t\tinitLayers: function () {\n\t\t\tthis.map.on('resize', function (evt) {\n\t\t\t\tvar pnt = evt.target.extent.getCenter();\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tevt.target.centerAt(pnt);\n\t\t\t\t}, 100);\n\t\t\t});\n\n\t\t\tthis.layers = [];\n\t\t\tvar layerTypes = {\n\t\t\t\tcsv: 'CSV',\n\t\t\t\tdynamic: 'ArcGISDynamicMapService',\n\t\t\t\tfeature: 'Feature',\n\t\t\t\tgeorss: 'GeoRSS',\n\t\t\t\timage: 'ArcGISImageService',\n\t\t\t\tkml: 'KML',\n\t\t\t\tlabel: 'Label', //untested\n\t\t\t\tmapimage: 'MapImage', //untested\n\t\t\t\tosm: 'OpenStreetMap',\n\t\t\t\ttiled: 'ArcGISTiledMapService',\n\t\t\t\twms: 'WMS',\n\t\t\t\twmts: 'WMTS' //untested\n\t\t\t};\n\t\t\t// loading all the required modules first ensures the layer order is maintained\n\t\t\tvar modules = [];\n\t\t\tarray.forEach(this.config.operationalLayers, function (layer) {\n\t\t\t\tvar type = layerTypes[layer.type];\n\t\t\t\tif (type) {\n\t\t\t\t\tmodules.push('esri/layers/' + type + 'Layer');\n\t\t\t\t} else {\n\t\t\t\t\tthis.handleError({\n\t\t\t\t\t\tsource: 'Controller',\n\t\t\t\t\t\terror: 'Layer type \"' + layer.type + '\"\" isnot supported: '\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, this);\n\t\t\trequire(modules, lang.hitch(this, function () {\n\t\t\t\tarray.forEach(this.config.operationalLayers, function (layer) {\n\t\t\t\t\tvar type = layerTypes[layer.type];\n\t\t\t\t\tif (type) {\n\t\t\t\t\t\trequire(['esri/layers/' + type + 'Layer'], lang.hitch(this, 'initLayer', layer));\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\t\t\t\tthis.map.addLayers(this.layers);\n\t\t\t}));\n\t\t},\n\t\tinitLayer: function (layer, Layer) {\n\t\t\tvar l = new Layer(layer.url, layer.options);\n\t\t\tthis.layers.unshift(l); //unshift instead of push to keep layer ordering on map intact\n\t\t\t//Legend LayerInfos array\n\t\t\tthis.legendLayerInfos.unshift({ //unshift instead of push to keep layer ordering in legend intact\n\t\t\t\tlayer: l,\n\t\t\t\ttitle: layer.title || null\n\t\t\t});\n\t\t\t//LayerControl LayerInfos array\n\t\t\tthis.layerControlLayerInfos.unshift({ //unshift instead of push to keep layer ordering in LayerControl intact\n\t\t\t\tlayer: l,\n\t\t\t\ttype: layer.type,\n\t\t\t\ttitle: layer.title,\n\t\t\t\tcontrolOptions: layer.layerControlLayerInfos\n\t\t\t});\n\t\t\tif (layer.type === 'feature') {\n\t\t\t\tvar options = {\n\t\t\t\t\tfeatureLayer: l\n\t\t\t\t};\n\t\t\t\tif (layer.editorLayerInfos) {\n\t\t\t\t\tlang.mixin(options, layer.editorLayerInfos);\n\t\t\t\t}\n\t\t\t\tthis.editorLayerInfos.push(options);\n\t\t\t}\n\t\t\tif (layer.type === 'dynamic' || layer.type === 'feature') {\n\t\t\t\tvar idOptions = {\n\t\t\t\t\tlayer: l,\n\t\t\t\t\ttitle: layer.title\n\t\t\t\t};\n\t\t\t\tif (layer.identifyLayerInfos) {\n\t\t\t\t\tlang.mixin(idOptions, layer.identifyLayerInfos);\n\t\t\t\t}\n\t\t\t\tif (idOptions.exclude !== true) {\n\t\t\t\t\tthis.identifyLayerInfos.push(idOptions);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tinitWidgets: function () {\n\t\t\tvar widgets = [],\n\t\t\t\tpaneWidgets;\n\n\t\t\tfor (var key in this.config.widgets) {\n\t\t\t\tif (this.config.widgets.hasOwnProperty(key)) {\n\t\t\t\t\tvar widget = lang.clone(this.config.widgets[key]);\n\t\t\t\t\tif (widget.include) {\n\t\t\t\t\t\twidget.position = ('undefined' !== typeof (widget.position)) ? widget.position : 10000;\n\t\t\t\t\t\twidgets.push(widget);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var pane in this.panes) {\n\t\t\t\tif (this.panes.hasOwnProperty(pane) && (pane !== 'outer' || pane !== 'center')) {\n\t\t\t\t\tpaneWidgets = array.filter(widgets, function (widget) {\n\t\t\t\t\t\treturn (widget.placeAt && widget.placeAt === pane);\n\t\t\t\t\t});\n\t\t\t\t\tpaneWidgets.sort(function (a, b) {\n\t\t\t\t\t\treturn a.position - b.position;\n\t\t\t\t\t});\n\t\t\t\t\tarray.forEach(paneWidgets, function (widget, i) {\n\t\t\t\t\t\tthis.widgetLoader(widget, i);\n\t\t\t\t\t}, this);\n\t\t\t\t}\n\t\t\t}\n\t\t\tpaneWidgets = array.filter(widgets, function (widget) {\n\t\t\t\treturn !widget.placeAt;\n\t\t\t});\n\t\t\tpaneWidgets.sort(function (a, b) {\n\t\t\t\treturn a.position - b.position;\n\t\t\t});\n\n\t\t\tarray.forEach(paneWidgets, function (widget, i) {\n\t\t\t\tthis.widgetLoader(widget, i);\n\t\t\t}, this);\n\t\t},\n\t\ttogglePane: function (id, show) {\n\t\t\tif (!this.panes[id]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar domNode = this.panes[id].domNode;\n\t\t\tif (domNode) {\n\t\t\t\tvar disp = (show && typeof (show) === 'string') ? show : (domStyle.get(domNode, 'display') === 'none') ? 'block' : 'none';\n\t\t\t\tdomStyle.set(domNode, 'display', disp);\n\t\t\t\tif (this.panes[id]._splitterWidget) { // show/hide the splitter, if found\n\t\t\t\t\tdomStyle.set(this.panes[id]._splitterWidget.domNode, 'display', disp);\n\t\t\t\t}\n\t\t\t\tthis.positionSideBarToggle(id);\n\t\t\t\tif (this.panes.outer) {\n\t\t\t\t\tthis.panes.outer.resize();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tpositionSideBarToggle: function (id) {\n\t\t\tvar pane = this.panes[id];\n\t\t\tvar btn = this.collapseButtons[id];\n\t\t\tif (!pane || !btn) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar disp = domStyle.get(pane.domNode, 'display');\n\t\t\tvar rCls = (disp === 'none') ? 'close' : 'open';\n\t\t\tvar aCls = (disp === 'none') ? 'open' : 'close';\n\t\t\tdomClass.remove(btn.children[0], rCls);\n\t\t\tdomClass.add(btn.children[0], aCls);\n\n\t\t\t// extra management required when the buttons\n\t\t\t// are not in the center map pane\n\t\t\tif (this.collapseButtonsPane === 'outer') {\n\t\t\t\tvar pos = (pane._splitterWidget) ? 0 : -1;\n\t\t\t\tvar orie = (id === 'bottom' || id === 'top') ? 'h' : 'w';\n\t\t\t\tif (disp === 'block') { // pane is open\n\t\t\t\t\tpos += domGeom.getMarginBox(pane.domNode)[orie];\n\t\t\t\t}\n\t\t\t\tif (pane._splitterWidget) { // account for a splitter\n\t\t\t\t\tpos += domGeom.getMarginBox(pane._splitterWidget.domNode)[orie];\n\t\t\t\t}\n\t\t\t\tdomStyle.set(btn, id, pos.toString() + 'px');\n\t\t\t\tdomStyle.set(btn, 'display', 'block');\n\t\t\t}\n\t\t},\n\n\t\trepositionSideBarButtons: function () {\n\t\t\tvar btns = ['left', 'right', 'top', 'bottom'];\n\t\t\tarray.forEach(btns, lang.hitch(this, function (id) {\n\t\t\t\tthis.positionSideBarToggle(id);\n\t\t\t}));\n\t\t},\n\n\t\t// extra management of splitters required when the buttons\n\t\t// are not in the center map pane\n\t\tsplitterStartDrag: function (id) {\n\t\t\tvar btn = this.collapseButtons[id];\n\t\t\tdomStyle.set(btn, 'display', 'none');\n\t\t},\n\t\tsplitterStopDrag: function (id) {\n\t\t\tthis.positionSideBarToggle(id);\n\t\t},\n\n\t\t_createTitlePaneWidget: function (parentId, title, position, open, canFloat, placeAt) {\n\t\t\tvar tp, options = {\n\t\t\t\t\ttitle: title || 'Widget',\n\t\t\t\t\topen: open || false,\n\t\t\t\t\tcanFloat: canFloat || false\n\t\t\t\t};\n\t\t\tif (parentId) {\n\t\t\t\toptions.id = parentId;\n\t\t\t}\n\t\t\tif (typeof (placeAt) === 'string') {\n\t\t\t\tplaceAt = this.panes[placeAt];\n\t\t\t}\n\t\t\tif (!placeAt) {\n\t\t\t\tplaceAt = this.panes.left;\n\t\t\t}\n\t\t\tif (placeAt) {\n\t\t\t\toptions.sidebar = placeAt;\n\t\t\t\ttp = new FloatingTitlePane(options).placeAt(placeAt, position);\n\t\t\t\ttp.startup();\n\t\t\t}\n\t\t\treturn tp;\n\t\t},\n\t\t_createFloatingWidget: function (parentId, title) {\n\t\t\tvar options = {\n\t\t\t\ttitle: title\n\t\t\t};\n\t\t\tif (parentId) {\n\t\t\t\toptions.id = parentId;\n\t\t\t}\n\t\t\tvar fw = new FloatingWidgetDialog(options);\n\t\t\tfw.startup();\n\t\t\treturn fw;\n\t\t},\n\t\t_createContentPaneWidget: function (parentId, title, className, region, placeAt) {\n\t\t\tvar cp, options = {\n\t\t\t\t\ttitle: title,\n\t\t\t\t\tregion: region || 'center'\n\t\t\t\t};\n\t\t\tif (className) {\n\t\t\t\toptions.className = className;\n\t\t\t}\n\t\t\tif (parentId) {\n\t\t\t\toptions.id = parentId;\n\t\t\t}\n\t\t\tif (!placeAt) {\n\t\t\t\tplaceAt = this.panes.sidebar;\n\t\t\t} else if (typeof (placeAt) === 'string') {\n\t\t\t\tplaceAt = this.panes[placeAt];\n\t\t\t}\n\t\t\tif (placeAt) {\n\t\t\t\tcp = new ContentPane(options).placeAt(placeAt);\n\t\t\t\tcp.startup();\n\t\t\t}\n\t\t\treturn cp;\n\t\t},\n\t\twidgetLoader: function (widgetConfig, position) {\n\t\t\tvar parentId, pnl;\n\n\t\t\t// only proceed for valid widget types\n\t\t\tvar widgetTypes = ['titlePane', 'contentPane', 'floating', 'domNode', 'invisible', 'map'];\n\t\t\tif (array.indexOf(widgetTypes, widgetConfig.type) < 0) {\n\t\t\t\tthis.handleError({\n\t\t\t\t\tsource: 'Controller',\n\t\t\t\t\terror: 'Widget type \"' + widgetConfig.type + '\" (' + widgetConfig.title + ') at position ' + position + ' is not supported.'\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// build a titlePane or floating widget as the parent\n\t\t\tif ((widgetConfig.type === 'titlePane' || widgetConfig.type === 'contentPane' || widgetConfig.type === 'floating') && (widgetConfig.id && widgetConfig.id.length > 0)) {\n\t\t\t\tparentId = widgetConfig.id + '_parent';\n\t\t\t\tif (widgetConfig.type === 'titlePane') {\n\t\t\t\t\tpnl = this._createTitlePaneWidget(parentId, widgetConfig.title, position, widgetConfig.open, widgetConfig.canFloat, widgetConfig.placeAt);\n\t\t\t\t} else if (widgetConfig.type === 'contentPane') {\n\t\t\t\t\tpnl = this._createContentPaneWidget(parentId, widgetConfig.title, widgetConfig.className, widgetConfig.region, widgetConfig.placeAt);\n\t\t\t\t} else if (widgetConfig.type === 'floating') {\n\t\t\t\t\tpnl = this._createFloatingWidget(parentId, widgetConfig.title);\n\t\t\t\t}\n\t\t\t\twidgetConfig.parentWidget = pnl;\n\t\t\t}\n\n\t\t\t// 2 ways to use require to accommodate widgets that may have an optional separate configuration file\n\t\t\tif (typeof (widgetConfig.options) === 'string') {\n\t\t\t\trequire([widgetConfig.options, widgetConfig.path], lang.hitch(this, 'createWidget', widgetConfig));\n\t\t\t} else {\n\t\t\t\trequire([widgetConfig.path], lang.hitch(this, 'createWidget', widgetConfig, widgetConfig.options));\n\t\t\t}\n\t\t},\n\t\tcreateWidget: function (widgetConfig, options, WidgetClass) {\n\t\t\t// set any additional options\n\t\t\toptions.id = widgetConfig.id + '_widget';\n\t\t\toptions.parentWidget = widgetConfig.parentWidget;\n\n\t\t\t//replace config map, layerInfos arrays, etc\n\t\t\tif (options.map) {\n\t\t\t\toptions.map = this.map;\n\t\t\t}\n\t\t\tif (options.mapRightClickMenu) {\n\t\t\t\t// create right-click menu\n\t\t\t\tif (!this.mapRightClickMenu) {\n\t\t\t\t\tthis.mapRightClickMenu = new Menu({\n\t\t\t\t\t\ttargetNodeIds: [this.map.root],\n\t\t\t\t\t\tselector: '.layersDiv' // restrict to map only\n\t\t\t\t\t});\n\t\t\t\t\tthis.mapRightClickMenu.startup();\n\t\t\t\t}\n\t\t\t\toptions.mapRightClickMenu = this.mapRightClickMenu;\n\t\t\t}\n\t\t\tif (options.mapClickMode) {\n\t\t\t\toptions.mapClickMode = this.mapClickMode.current;\n\t\t\t}\n\t\t\tif (options.legendLayerInfos) {\n\t\t\t\toptions.layerInfos = this.legendLayerInfos;\n\t\t\t}\n\t\t\tif (options.layerControlLayerInfos) {\n\t\t\t\toptions.layerInfos = this.layerControlLayerInfos;\n\t\t\t}\n\t\t\tif (options.editorLayerInfos) {\n\t\t\t\toptions.layerInfos = this.editorLayerInfos;\n\t\t\t}\n\t\t\tif (options.identifyLayerInfos) {\n\t\t\t\toptions.layerInfos = this.identifyLayerInfos;\n\t\t\t}\n\n\t\t\t// create the widget\n\t\t\tvar pnl = options.parentWidget;\n\t\t\tif ((widgetConfig.type === 'titlePane' || widgetConfig.type === 'contentPane' || widgetConfig.type === 'floating')) {\n\t\t\t\tthis[widgetConfig.id] = new WidgetClass(options, put('div')).placeAt(pnl.containerNode);\n\t\t\t} else if (widgetConfig.type === 'domNode') {\n\t\t\t\tthis[widgetConfig.id] = new WidgetClass(options, widgetConfig.srcNodeRef);\n\t\t\t} else {\n\t\t\t\tthis[widgetConfig.id] = new WidgetClass(options);\n\t\t\t}\n\n\t\t\t// start up the widget\n\t\t\tif (this[widgetConfig.id] && this[widgetConfig.id].startup && !this[widgetConfig.id]._started) {\n\t\t\t\tthis[widgetConfig.id].startup();\n\t\t\t}\n\t\t},\n\t\t//centralized error handler\n\t\thandleError: function (options) {\n\t\t\tif (this.config.isDebug) {\n\t\t\t\tif (typeof (console) === 'object') {\n\t\t\t\t\tfor (var option in options) {\n\t\t\t\t\t\tif (options.hasOwnProperty(option)) {\n\t\t\t\t\t\t\tconsole.log(option, options[option]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// add growler here?\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t};\n});"]}